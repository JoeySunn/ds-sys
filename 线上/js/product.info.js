$(function(){var j=window.parent.asys,f,l,o,i=util.getQueryParam("type"),e=util.getQueryParam("order"),a=util.getQueryParam("id");if(!i||!a){h("信息有误");if(j){j.closeModal()}}function h(p){if(!p){p="请求数据失败！请稍后再试"}if(j){j.showAlert({title:"温馨提醒",msg:p,isCancel:false})}else{alert(p)}}function d(){if(!a){return}$.ajax({type:"POST",url:util.getURL("Product/info"),data:{id:a,info_module:0},dataType:"json",success:function(s){if(s.status){f=s.info;var p=s.info;$("div[name='explain']").html(p.explain?p.explain:"");$("div[name='claim']").html(p.claim?p.claim:"");$("input[name=tgf_amt]").val(p.tgf_amt?p.tgf_amt:"");$("p[name=tgf_amt]").html(p.tgf_amt?p.tgf_amt:"");$("input[name=price]").val(p.price?p.price:"");$("p[name=price]").html(p.price?p.price:"");if(p.prem_calc==1){$("p[name=prem_calc]").text("按保险方案")}else{if(p.prem_calc==2){$("p[name=prem_calc]").text("按年龄段")}else{if(p.prem_calc==3){$("p[name=prem_calc]").text("按保险期间")}else{$("p[name=prem_calc]").text("未知")}}}$("select[name=insurer_id]").val(p.insurer_id?p.insurer_id:"");$("select[name=insurer_id]").attr("insurer_id",p.insurer_id?p.insurer_id:"");$("p[name=insurer_name]").html(p.insurer_name?p.insurer_name:"");$("select[name=ins_id]").val(p.ins_id?p.ins_id:"");$("select[name=ins_id]").attr("ins_id",p.ins_id?p.ins_id:"");$("p[name=ins_name]").html(p.ins_name?p.ins_name:"");$("img[name='image_url']").attr("src",(p.image_url?p.image_url:""));$("p[name='code']").html(p.code?p.code:"");$("p[name='name']").html(p.name?p.name:"");$("p[name='title']").html(p.title?p.title:"");$("p[name='insured_area']").html(p.insured_area?p.insured_area:"");$("p[name='ins_limit']").html(p.ins_limit?p.ins_limit:"");$("input[name='link']").val(p.link?p.link:"");$("p[name='link']").html(p.link?p.link:"");if(p.butt_mode==1){$("[name='butt_mode'][value='1']").prop("checked",true);$("p[name='butt_mode']").html("平台对接")}else{if(p.butt_mode==2){$("[name='butt_mode'][value='2']").prop("checked",true);$("p[name='butt_mode']").html("外链产品")}else{$("p[name='butt_mode']").html("未知")}}var y="";if(p.type==1){y="产品推广";if(i=="show"){$("#type_show_1").show()}else{$("#type_1").show()}}else{if(p.type==2){y="产品定制";if(i=="show"){$("#type_show_2").show()}else{$("#type_2").show()}}else{if(p.type==3){y="产品推广;产品定制";if(i=="show"){$("#type_show_1").show();$("#type_show_2").show()}else{$("#type_1").show();$("#type_2").show()}}else{$("#type_show_1").hide();$("#type_show_2").hide()}}}if(p.cls_name){$("#type_show_1 [name='cls']").show();$("#type_show_1 #cls_box").html(p.cls_name)}else{$("#type_show_1 [name='cls']").hide()}$("#type_show_1 [name='ins']").show();if(p.ins_type==1){$("#type_show_1 .ins_box").html("意外险")}else{if(p.ins_type==2){$("#type_show_1 .ins_box").html("健康险")}else{if(p.ins_type==3){$("#type_show_1 .ins_box").html("责任险")}else{if(p.ins_type==4){$("#type_show_1 .ins_box").html("财产险")}else{$("#type_show_1 [name='ins']").hide()}}}}if(p.scene_name){$("#type_show_2").show();$("#type_show_2 #scene_box").html(p.scene_name)}else{$("#type_show_2").hide()}$("p[name='type']").html(y);$("p[name='fit_people']").html(p.fit_people?p.fit_people:"");$("div[name='desc']").html(p.desc?p.desc:"");if(p.exten){var A=[];$.each(p.exten,function(B,C){if(C.type==1){A.push("二维码")}else{if(C.type==2){A.push("推广链接")}else{if(C.type==3){A.push("APP接口")}}}});$("p[name=extens]").html(A.toString())}else{$("p[name=extens]").html("")}var t=p.app_age_start,z=p.app_age_end,r=p.insrnt_age_start,w=p.insrnt_age_end,x=p.app_age_start_type,u=p.app_age_end_type,v=p.insrnt_age_start_type,q=p.insrnt_age_end_type;if(t==0&&z==400){$("p[name=app_age]").html("不限")}else{if(z==400){$("p[name=app_age]").html(t+b(x)+"以上")}else{if(parseInt(z)==-1){$("p[name=app_age]").html(t+b(x)+"以下")}else{if(u==x){$("p[name=app_age]").html(t+"-"+z+b(u))}else{$("p[name=app_age]").html(t+b(x)+"-"+z+b(u))}}}}if(r==0&&w==400){$("p[name=insrnt_age]").html("不限")}else{if(w==400){$("p[name=insrnt_age]").html(r+b(v)+"以上")}else{if(parseInt(w)==-1){$("p[name=insrnt_age]").html(r+b(v)+"以下")}else{if(q==v){$("p[name=insrnt_age]").html(r+"-"+w+b(v))}else{$("p[name=insrnt_age]").html(r+b(v)+"-"+w+b(q))}}}}if(p.status==1){$("#save_btn").hide()}}else{h(s.info);if(j){j.closeModal()}}},error:function(){h();if(j){j.closeModal()}}});$.ajax({type:"POST",url:util.getURL("Product/risk_lists"),data:{product_id:a},dataType:"json",success:function(s){if(s.status){var t=s.info;$("#risk tbody").html("");if(t){for(var q=0;q<t.length;q++){var u=t[q],r=null,p="<tr><td>"+(u.risk_type?u.risk_type:"-")+"</td><td>"+(u.risk_name?u.risk_name:"-")+"</td>";if(u.has_attr==1){$("#risk  .risk_attr").show();p+="<td class='operation'><a opName='attr_show'>查看</a></td>";l=true}else{p+="<td class='operation risk_attr' "+(l?"":"hidden")+"></td>"}p+="<td class='operation'><a opName='item_config'>查看</a></td><td class='operation'><a opName='premium_config'>查看</a></td></tr>";$("#risk tbody").append(p);$("#risk tbody tr:last")[0].trData=u}}else{$("#risk").html("<div class='noData'>暂无配置</div>")}m()}else{h(s.info);if(j){j.closeModal()}}},error:function(){h();if(j){j.closeModal()}}})}function n(q){var p="";$("#premium tbody").html("");$("#premium thead tr").html("");if(f.prem_calc==1){p="<th>方案名称</th><th>保险期间（天）</th><th>保费（元）</th><th class='"+(i=="show"?"hidden":"")+"'>操作</th>";$("#premium thead tr").html(p);$("#premium .add_btn_box").remove();p="<tr><td>"+q.risk_name+"</td><td>"+(q.risk_day?q.risk_day:"-")+"</td><td>"+(q.risk_price?q.risk_price:"--")+"</td><td class='operation "+(i=="show"?"hidden":"")+"'><a opName='edit'>编辑</a> </td></tr>";$("#premium tbody").html(p);$("#premium").modal("show")}else{$.ajax({type:"POST",url:util.getURL("Product/prem_lists"),data:{product_id:a,risk_type:q.risk_type},dataType:"json",success:function(t){if(t.status){var v=t.info,u=v?v.length:0,s;$("#premium tbody").html("");if(f.prem_calc==2){p="<th>方案名称</th><th>保险期间（天）</th><th>年龄段</th><th>保费（元）</th>";$("#premium thead tr").html(p);$("#premium .add_btn_box").hide();p="<tr><td rowspan="+u+">"+q.risk_name+"</td><td rowspan="+u+">"+(q.risk_day?q.risk_day:"-")+"</td>";if(u==0){p+="<td>-</td><td>-</td>"}else{s=v[0];p+="<td>"+c(s.start_num,s.end_num,s.start_type,s.end_type)+"</td>";p+="<td>"+s.n_prm+"</td></tr>"}$("#premium tbody").append(p);$("#premium tbody tr:last")[0].trData=s;$("#premium tbody tr:last")[0].riskData=q;for(var r=1;r<u;r++){s=v[r];p="<tr><td>"+c(s.start_num,s.end_num,s.start_type,s.end_type)+"</td>";p+="<td>"+s.n_prm+"</td></tr>";$("#premium tbody").append(p)}}else{if(f.prem_calc==3){p="<th>方案名称</th><th>保险期间</th><th>保费（元）</th>";$("#premium thead tr").html(p);$("#premium .add_btn_box").hide();p="<tr><td rowspan="+u+">"+q.risk_name+"</td>";if(u==0){p+="<td>-</td><td>-</td></tr>"}else{s=v[0];if(s.type==2){p+="<td>全年</td>"}else{p+="<td>"+s.start_num+"天-"+s.end_num+"天</td>"}p+="<td>"+s.n_prm+"</td></tr>"}$("#premium tbody").append(p);for(var r=1;r<u;r++){s=v[r];if(s.type==2){p="<tr><td>全年</td>"}else{p="<tr><td>"+s.start_num+"天-"+s.end_num+"天</td>"}p+="<td>"+s.n_prm+"</td></tr>";$("#premium tbody").append(p)}}else{if(f.prem_calc==4){p="<th>方案名称</th><th>年龄段</th><th>保险期间</th><th>保费（元）</th>";$("#premium thead tr").html(p);$("#premium .add_btn_box").hide();p="<tr><td rowspan="+u+">"+q.risk_name+"</td>";if(u==0){p+="<td>-</td><td>-</td><td>-</td></tr>"}else{s=v[0];p+="<td>"+(s.attr_name?s.attr_name:"")+"</td>";if(s.type==2){p+="<td>全年</td>"}else{p+="<td>"+s.start_num+"天-"+s.end_num+"天</td>"}p+="<td>"+s.n_prm+"</td></tr>"}$("#premium tbody").append(p);for(var r=1;r<u;r++){s=v[r];p+="<tr><td>"+(s.attr_name?s.attr_name:"")+"</td>";if(s.type==2){p="<td>全年</td>"}else{p="<td>"+s.start_num+"天-"+s.end_num+"天</td>"}p+="<td>"+s.n_prm+"</td></tr>";$("#premium tbody").append(p)}}}}$("#premium").modal("show")}else{h(t.info)}},error:function(){h()}})}}function k(p){$.ajax({type:"POST",url:util.getURL("Product/kind_lists"),data:{product_id:a,risk_type:p.risk_type},dataType:"json",success:function(t){if(t.status){$("#itemSee").modal("show");$("#itemSee tbody").html("");var v=t.info,u=v?v.length:0,s,r;$("#itemSee .add_btn_box").hide();r="<tr><td rowspan="+u+">"+(p.risk_name?p.risk_name:"--")+"</td>";if(u==0){r+="<td>-</td><td>-</td><td>-</td><td>-</td>"}else{s=v[0];r+="<td>"+(s.kind_cde?s.kind_cde:"--")+"</td><td>"+(s.kind_name?s.kind_name:"--")+"</td><td>"+(s.n_amt?s.n_amt:"--")+"</td><td>"+(s.kind_desc?s.kind_desc:"--")+"</td>"}r+="</tr>";$("#itemSee tbody").append(r);$("#itemSee tbody tr:last")[0].trData=s;$("#itemSee tbody tr:last")[0].riskData=p;for(var q=1;q<u;q++){s=v[q];r="<tr><td>"+(s.kind_cde?s.kind_cde:"--")+"</td><td>"+(s.kind_name?s.kind_name:"--")+"</td><td>"+(s.n_amt?s.n_amt:"--")+"</td><td>"+(s.kind_desc?s.kind_desc:"--")+"</td>";r+="</tr>";$("#itemSee tbody").append(r);$("#itemSee tbody tr:last")[0].trData=s;$("#itemSee tbody tr:last")[0].riskData=p}}else{h(t.info)}},error:function(){h()}})}function g(p){$.ajax({type:"POST",url:util.getURL("Product/risk_attr_info"),data:{product_id:a,risk_type:p.risk_type},dataType:"json",success:function(q){if(q.status){$("#attr").modal("show");$("#attr #editboxLabel").text(p.risk_name);$("#attr input[name=risk_type]").val(p.risk_type);$("#attr .form-horizontal").html("");o=q.info.length;$.each(q.info,function(){var s='<div class="form-group"><label class="radio col-sm-3">'+this.attr_name+"</label>";$("#attr #cancle_btn").text("关闭");$("#attr #submit_btn").hide();if(this.options){for(var r=0;r<this.options.length;r++){if(this.options[r].is_select==1){s+='<label class="radio col-sm-3">'+this.options[r].name+"</label>"}}}s+="</div>";$("#attr .form-horizontal").append(s)})}else{h(q.info)}},error:function(){h()}})}function b(p){return p==1?"周岁":p==2?"月":p==3?"天":"周岁"}function c(p,r,q,s){if(p==0&&r==400){return"不限"}else{if(r==400){return p+b(q)+"以上"}else{if(parseInt(r)==-1){return p+b(q)+"以下"}else{if(s==q){return p+"-"+r+b(s)}else{return p+b(q)+"-"+r+b(s)}}}}}function m(){$("#risk .operation a").click(function(){var q=$(this).attr("opName"),p=$(this).closest("tr")[0].trData;opData=p;if(q=="premium_config"){n(p)}else{if(q=="item_config"){k(p)}else{if(q=="attr_show"){g(p)}}}})}d();if(i=="show"){$(".edit").remove()}if(e==1){$("#save_btn").hide();$("#preview_btn").hide()}$("#cancle_btn").click(function(){if(j){j.closeModal()}});$("#preview_btn").click(function(){window.open(util.getProductPreview(a))});$("#save_btn").click(function(){$.ajax({type:"POST",url:util.getURL("Product/status_do"),data:{id:a,type:1},dataType:"json",success:function(p){if(p.status){h("上架成功");j.closeModal()}else{h(p.info)}},error:function(){h()}})})});