$(function(){var c=window.parent.asys,e,g=util.getQueryParam("type"),f=util.getQueryParam("id");if(!g||!f){d("信息有误");if(c){c.closeModal()}}function d(h){if(!h){h="请求数据失败！请稍后再试"}if(c){c.showAlert({title:"温馨提醒",msg:h,isCancel:false})}else{alert(h)}}KindEditor.ready(function(h){e=h.create("textarea[name=explain]",{allowImageUpload:true,uploadJson:util.getURL("FileUpload/ueditor_upload"),afterUpload:function(){this.sync()},afterBlur:function(){this.sync()}});a()});function b(h){if(!h){return}h.id=f;h.save_module=3;$.ajax({type:"POST",url:util.getURL("Product/edit_do"),data:h,dataType:"json",success:function(i){if(i.status){d("保存成功");if(c){c.closeModal()}}else{d(i.info)}},error:function(){d()}})}function a(){if(!f){return}$.ajax({type:"POST",url:util.getURL("Product/info"),data:{id:f,info_module:3},dataType:"json",success:function(h){if(h.status){var i=h.info;$("textarea[name='explain']").val(i.explain?i.explain:"");if(e){e.html(i.explain?i.explain:"")}$("div[name='explain']").html(i.explain?i.explain:"")}else{d(h.info);if(c){c.closeModal()}}},error:function(){d();if(c){c.closeModal()}}})}if(g=="show"){$(".edit").remove();$(".button_box").remove();$(".cancle_box").text("关闭")}else{$(".show").remove()}$("input[name='type']").click(function(){var h=this.value;if(this.checked){$("#type_"+h).show()}else{$("#type_"+h).hide()}});$("#cancle_btn").click(function(){if(c){c.closeModal()}});$("#confirm_btn").click(function(){var j=$("form:first").serializeArray(),i=false,k={},h=false;$.each(j,function(){if(this.value){if(k[this.name]){k[this.name]+=","+this.value}else{k[this.name]=this.value}}else{i=true}});if(i){d("请完善配置信息")}else{k.save_status=2;b(k)}});$("#save_btn").click(function(){var j=$("form:first").serializeArray(),i=false,k={},h=false;$.each(j,function(){if(k[this.name]){k[this.name]+=","+this.value}else{k[this.name]=this.value}});k.save_status=1;b(k)})});